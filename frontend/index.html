<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>verde</title>
    <!-- Tailwind CSS for modern styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts for a clean, modern look -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="index.css">
  </head>
<body class="bg-gray-50 text-gray-800">

    <!-- Main Content Container -->
    <main id="main-content" class="min-h-screen flex flex-col items-center justify-center p-4 transition-opacity duration-500">
        <div class="w-full max-w-2xl mx-auto">
            <header class="text-center mb-8">
                <h1 class="text-5xl md:text-6xl font-bold text-green-600">verde</h1>
                <p class="text-gray-500 mt-2" id="rotating-text">vegetarian-ize any meal.</p>
            </header>

            <!-- Input Form -->
            <form id="recipe-form" class="space-y-4">
                <!-- Dish Name Input with Arrow Button -->
                <div>
                    <label for="dish-input" class="block text-sm font-medium text-gray-700 mb-1">dish name</label>
                    <div class="flex gap-2">
                        <input type="text" id="dish-input" name="dish" placeholder="e.g., shepherd's pie" required
                            class="flex-1 px-4 py-3 bg-white border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent transition">
                        <button type="submit" id="submit-button"
                            class="px-4 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition shadow-lg flex items-center justify-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" clip-rule="evenodd" />
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Filters List -->
                <div class="flex flex-wrap gap-4 text-sm">
                    <span class="text-gray-500">filters:</span>
                    <label class="flex items-center space-x-2 cursor-pointer">
                        <input type="checkbox" name="filter" value="vegetarian" class="h-4 w-4 rounded border-gray-300 text-green-600 focus:ring-green-500" checked>
                        <span class="text-gray-700">vegetarian</span>
                    </label>
                    <label class="flex items-center space-x-2 cursor-pointer">
                        <input type="checkbox" name="filter" value="vegan" class="h-4 w-4 rounded border-gray-300 text-green-600 focus:ring-green-500">
                        <span class="text-gray-700">vegan</span>
                    </label>
                    <label class="flex items-center space-x-2 cursor-pointer">
                        <input type="checkbox" name="filter" value="kosher" class="h-4 w-4 rounded border-gray-300 text-green-600 focus:ring-green-500">
                        <span class="text-gray-700">kosher</span>
                    </label>
                    <label class="flex items-center space-x-2 cursor-pointer">
                        <input type="checkbox" name="filter" value="gluten-free" class="h-4 w-4 rounded border-gray-300 text-green-600 focus:ring-green-500">
                        <span class="text-gray-700">gluten-free</span>
                    </label>
                    <label class="flex items-center space-x-2 cursor-pointer">
                        <input type="checkbox" name="filter" value="dairy-free" class="h-4 w-4 rounded border-gray-300 text-green-600 focus:ring-green-500">
                        <span class="text-gray-700">dairy-free</span>
                    </label>
                    <label class="flex items-center space-x-2 cursor-pointer">
                        <input type="checkbox" name="filter" value="nut-free" class="h-4 w-4 rounded border-gray-300 text-green-600 focus:ring-green-500">
                        <span class="text-gray-700">nut-free</span>
                    </label>
                </div>

                <!-- Optional Recipe Input -->
                <div>
                    <label for="recipe-input" class="block text-sm font-medium text-gray-700 mb-1">
                        original recipe (optional)
                    </label>
                    <textarea id="recipe-input" name="recipe" rows="6"
                        placeholder="paste a recipe here for a more accurate conversion..."
                        class="w-full px-4 py-3 bg-white border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent transition"></textarea>
                </div>
            </form>

        </div>

        <!-- Example Recipes Slider -->
        <div class="w-full max-w-4xl mt-12">
            <h2 class="text-xl font-bold text-center mb-4">popular conversions</h2>
            <div class="example-scroller flex gap-4 overflow-x-auto pb-4">
                <!-- Example Card 1 -->
                <div class="flex-shrink-0 w-64 bg-white rounded-lg shadow-md overflow-hidden">
                    <img src="https://placehold.co/600x400/22c55e/ffffff?text=lentil+shepherd's+pie" alt="lentil shepherd's pie" class="w-full h-32 object-cover">
                    <div class="p-4">
                        <h3 class="font-semibold">lentil shepherd's pie</h3>
                        <p class="text-sm text-gray-500">from shepherd's pie</p>
                    </div>
                </div>
                <!-- Example Card 2 -->
                <div class="flex-shrink-0 w-64 bg-white rounded-lg shadow-md overflow-hidden">
                    <img src="https://placehold.co/600x400/22c55e/ffffff?text=mushroom+bolognese" alt="mushroom bolognese" class="w-full h-32 object-cover">
                    <div class="p-4">
                        <h3 class="font-semibold">mushroom bolognese</h3>
                        <p class="text-sm text-gray-500">from spaghetti bolognese</p>
                    </div>
                </div>
                <!-- Example Card 3 -->
                <div class="flex-shrink-0 w-64 bg-white rounded-lg shadow-md overflow-hidden">
                    <img src="https://placehold.co/600x400/22c55e/ffffff?text=tofu+tikka+masala" alt="tofu tikka masala" class="w-full h-32 object-cover">
                    <div class="p-4">
                        <h3 class="font-semibold">tofu tikka masala</h3>
                        <p class="text-sm text-gray-500">from chicken tikka masala</p>
                    </div>
                </div>
                <!-- Example Card 4 -->
                 <div class="flex-shrink-0 w-64 bg-white rounded-lg shadow-md overflow-hidden">
                    <img src="https://placehold.co/600x400/22c55e/ffffff?text=veggie+pot+pie" alt="veggie pot pie" class="w-full h-32 object-cover">
                    <div class="p-4">
                        <h3 class="font-semibold">veggie pot pie</h3>
                        <p class="text-sm text-gray-500">from chicken pot pie</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Loading Screen - Hidden by default -->
    <div id="loading-screen" class="hidden min-h-screen w-full fixed top-0 left-0 bg-gray-50 flex flex-col items-center justify-center transition-opacity duration-500 opacity-0">
        <!-- Back Arrow Button -->
        <button id="back-button" class="absolute top-6 left-6 p-2 text-gray-500 hover:text-gray-700 transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd" />
            </svg>
        </button>
        
        <div class="text-center">
            <!-- Simple SVG Spinner -->
            <svg class="animate-spin h-12 w-12 text-green-600 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <h2 class="text-2xl font-bold text-green-600 mt-6">our ai chef is working its magic...</h2>
            <p class="text-gray-500 mt-2">preparing your custom vegetarian recipe.</p>
        </div>
    </div>

    <!-- Results Screen - Changed from fixed to absolute positioning for better scrolling -->
    <div id="results-screen" class="hidden w-full absolute top-0 left-0 bg-gray-50 transition-opacity duration-500 opacity-0">
        <!-- Header with back button -->
        <div class="bg-white shadow-sm border-b sticky top-0 z-10">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center py-4">
                    <div class="flex items-center">
                        <h1 class="text-2xl font-bold text-green-600">verde</h1>
                        <span class="ml-2 text-gray-500">recipe comparison</span>
                    </div>
                    <button id="results-back-button" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition">
                        New Recipe
                    </button>
                </div>
            </div>
        </div>

        <!-- Scrollable content -->
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Original Recipe -->
                <div class="bg-white rounded-lg shadow-lg overflow-hidden">
                    <div class="bg-red-50 px-6 py-4 border-b">
                        <h2 class="text-xl font-bold text-red-700 flex items-center">
                            <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd"></path>
                            </svg>
                            Original Recipe
                        </h2>
                    </div>
                    <div class="p-6">
                        <div id="original-recipe-content" class="prose prose-sm max-w-none whitespace-pre-wrap overflow-y-auto max-h-96">
                            <!-- Original recipe content will be inserted here -->
                        </div>
                    </div>
                </div>

                <!-- Vegetarian Recipe -->
                <div class="bg-white rounded-lg shadow-lg overflow-hidden">
                    <div class="bg-green-50 px-6 py-4 border-b">
                        <h2 id="vegetarian-recipe-title" class="text-xl font-bold text-green-700 flex items-center">
                            <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd"></path>
                            </svg>
                            Vegetarian Version
                        </h2>
                    </div>
                    <div class="p-6">
                        <div id="vegetarian-recipe-content" class="prose prose-sm max-w-none whitespace-pre-wrap overflow-y-auto max-h-96">
                            <!-- Vegetarian recipe content will be inserted here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="mt-8 text-center">
                <button id="copy-vegetarian-btn" class="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition mr-4">
                    Copy New Recipe
                </button>
                <button id="new-recipe-btn" class="px-6 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition">
                    New Recipe
                </button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const recipeForm = document.getElementById('recipe-form');
            const mainContent = document.getElementById('main-content');
            const loadingScreen = document.getElementById('loading-screen');
            const resultsScreen = document.getElementById('results-screen');
            const rotatingText = document.getElementById('rotating-text');
            const backButton = document.getElementById('back-button');
            const resultsBackButton = document.getElementById('results-back-button');
            const copyVegetarianBtn = document.getElementById('copy-vegetarian-btn');
            const newRecipeBtn = document.getElementById('new-recipe-btn');
            const vegetarianRecipeTitle = document.getElementById('vegetarian-recipe-title');

            // Rotating text effect
            const textOptions = [
                'vegetarian-ize any meal.',
                'vegan-ize any meal.',
                'kosher-ize any meal.',
                'gluten-free-ize any meal.',
                'dairy-free-ize any meal.',
                'nut-free-ize any meal.',
                'plant-based-ize any meal.'
            ];
            
            let currentIndex = 0;
            
            function rotateText() {
                rotatingText.style.opacity = '0';
                setTimeout(() => {
                    currentIndex = (currentIndex + 1) % textOptions.length;
                    rotatingText.textContent = textOptions[currentIndex];
                    rotatingText.style.opacity = '1';
                }, 300);
            }
            
            // Start rotating text every 3 seconds
            setInterval(rotateText, 3000);

            // Function to format restrictions into a readable string
            function formatRestrictions(restrictions) {
                if (!restrictions || restrictions.length === 0) {
                    return "vegetarian";
                }
                
                // Sort restrictions for consistent ordering
                const sortedRestrictions = restrictions.sort();
                
                // Join with spaces and capitalize first letter of each word
                return sortedRestrictions.map(restriction => {
                    return restriction.split('-').map(word => 
                        word.charAt(0).toUpperCase() + word.slice(1)
                    ).join('-');
                }).join(' ');
            }

            // Back button functionality
            backButton.addEventListener('click', () => {
                // Fade out the loading screen
                loadingScreen.classList.add('opacity-0');
                
                // After the fade-out animation, hide the loading screen and show the main content
                setTimeout(() => {
                    loadingScreen.classList.add('hidden');
                    mainContent.style.display = 'flex';
                    // Fade in the main content
                    setTimeout(() => mainContent.classList.remove('opacity-0'), 20);
                }, 500);
            });

            // Results back button functionality
            resultsBackButton.addEventListener('click', () => {
                // Fade out the results screen
                resultsScreen.classList.add('opacity-0');
                
                // After the fade-out animation, hide the results screen and show the main content
                setTimeout(() => {
                    resultsScreen.classList.add('hidden');
                    mainContent.style.display = 'flex';
                    // Fade in the main content
                    setTimeout(() => mainContent.classList.remove('opacity-0'), 20);
                }, 500);
            });

            // New recipe button
            newRecipeBtn.addEventListener('click', () => {
                // Fade out the results screen
                resultsScreen.classList.add('opacity-0');
                
                // After the fade-out animation, hide the results screen and show the main content
                setTimeout(() => {
                    resultsScreen.classList.add('hidden');
                    mainContent.style.display = 'flex';
                    // Fade in the main content
                    setTimeout(() => mainContent.classList.remove('opacity-0'), 20);
                }, 500);
            });

            // Copy vegetarian recipe button
            copyVegetarianBtn.addEventListener('click', () => {
                const vegetarianContent = document.getElementById('vegetarian-recipe-content').textContent;
                navigator.clipboard.writeText(vegetarianContent).then(() => {
                    // Show success feedback
                    const btn = copyVegetarianBtn;
                    const originalText = btn.textContent;
                    btn.textContent = 'Copied!';
                    btn.classList.add('bg-green-500');
                    setTimeout(() => {
                        btn.textContent = originalText;
                        btn.classList.remove('bg-green-500');
                    }, 2000);
                });
            });

            // Event listener for the form submission
            recipeForm.addEventListener('submit', async (event) => {
                event.preventDefault(); // Prevent the default page reload

                // 1. GATHER ALL USER INPUTS
                const dishName = document.getElementById('dish-input').value;
                const originalRecipe = document.getElementById('recipe-input').value;
                
                // Get all checked filter checkboxes
                const checkedFilters = document.querySelectorAll('input[name="filter"]:checked');
                const activeFilters = Array.from(checkedFilters).map(checkbox => checkbox.value);

                // 2. PREPARE DATA FOR THE BACKEND
                const requestData = {
                    dish_name: dishName,
                    original_recipe: originalRecipe,
                    filters: activeFilters
                };
                
                console.log('data being sent to backend:', requestData);

                // 3. TRANSITION TO THE LOADING SCREEN
                mainContent.classList.add('opacity-0');
                
                setTimeout(() => {
                    mainContent.style.display = 'none';
                    loadingScreen.classList.remove('hidden');
                    setTimeout(() => loadingScreen.classList.remove('opacity-0'), 20); 
                }, 500);

                // 4. CALL THE BACKEND WITH YOUR AI PIPELINE
                try {
                    const response = await fetch('/generate-recipe', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(requestData),
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const result = await response.json();
                    
                    if (result.success) {
                        // Show the results with formatted restrictions
                        displayResults(result.original_recipe, result.vegetarian_recipe, activeFilters);
                    } else {
                        throw new Error(result.error_message || 'Failed to generate recipe');
                    }

                } catch (error) {
                    console.error("Failed to fetch recipe:", error);
                    alert('Sorry, something went wrong. Please try again!');
                    // Revert the UI on error
                    loadingScreen.classList.add('opacity-0');
                    setTimeout(() => {
                        loadingScreen.classList.add('hidden');
                        mainContent.style.display = 'flex';
                        setTimeout(() => mainContent.classList.remove('opacity-0'), 20);
                    }, 500);
                }
            });

            function displayResults(original, vegetarian, restrictions) {
                // Hide loading screen and show results
                loadingScreen.classList.add('opacity-0');
                
                setTimeout(() => {
                    loadingScreen.classList.add('hidden');
                    resultsScreen.classList.remove('hidden');
                    setTimeout(() => resultsScreen.classList.remove('opacity-0'), 20);
                }, 500);

                // Format restrictions for display
                const formattedRestrictions = formatRestrictions(restrictions);
                
                // Update the vegetarian recipe title
                vegetarianRecipeTitle.innerHTML = `
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd"></path>
                    </svg>
                    ${formattedRestrictions} Version
                `;

                // Display the recipes
                document.getElementById('original-recipe-content').textContent = original;
                document.getElementById('vegetarian-recipe-content').textContent = vegetarian;
            }
        });
    </script>

  </body>
</html>

